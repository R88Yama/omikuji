<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãŠã¿ãã˜</title>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f7f5ef;
      text-align: center;
      padding-top: 15vh;
    }

    button {
      font-size: 1.2rem;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      background: #c62828;
      color: white;
    }

    /* ===== æ¼”å‡ºç”¨ ===== */

    /* å›è»¢ã™ã‚‹çµµæ–‡å­— */
    #spinner {
      margin-top: 24px;
      font-size: 4rem;      /* â† ã‚µã‚¤ã‚ºã¯ã“ã“ */
      display: none;        /* â† åˆæœŸã¯éè¡¨ç¤º */
      animation: spin 0.6s linear infinite;
      line-height: 1;
    }

    /* å›ã‚‰ãªã„æ–‡ç«  */
    #loadingText {
      margin-top: 8px;
      font-size: 1rem;
      color: #555;
      display: none;        /* â† åˆæœŸã¯éè¡¨ç¤º */
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }

    /* ===== çµæœè¡¨ç¤º ===== */

    #result {
      margin-top: 24px;
      font-size: 1.6rem;
      font-weight: bold;
    }

    #special {
      margin-top: 24px;
      font-size: 2.4rem;
      font-weight: bold;
      color: #c62828;
    }
  </style>
</head>

<body>

  <h1>ãŠã¿ãã˜</h1>

  <button id="drawBtn" onclick="drawOmikuji()">å¼•ã</button>

  <!-- æ¼”å‡º -->
  <div id="spinner">ğŸ¥ </div>
  <div id="loadingText">æ—¥é ƒã®è¡Œã„è©•ä¾¡ä¸­...</div>

  <!-- çµæœ -->
  <div id="result"></div>
  <div id="special"></div>

  <script>
    /* ===== é‹å‹¢ãƒ‡ãƒ¼ã‚¿ï¼ˆç¢ºç‡ã¤ããƒ»å„3ç¨®é¡ï¼‰ ===== */
    const omikuji = [
      {
        name: "å¤§å‰",
        weight: 5,
        msgs: [
          "ç‰©äº‹ãŒé †èª¿ã«é€²ã¿ã‚„ã™ã„æ—¥ã€‚è¿·ã£ãŸã‚‰å‰å‘ããªé¸æŠã§å•é¡Œãªã„ã€‚",
          "åŠªåŠ›ãŒçµæœã«çµã³ã¤ãã‚„ã™ã„ã€‚ç©ã¿é‡ã­ã¦ããŸã“ã¨ã‚’ä¿¡ã˜ã¦ã‚ˆã„ã€‚",
          "å‘¨å›²ã‹ã‚‰ã®è©•ä¾¡ãŒä¸ŠãŒã‚Šã‚„ã™ã„ã€‚æ™®æ®µé€šã‚ŠãŒä¸€ç•ªå¼·ã„ã€‚"
        ]
      },
      {
        name: "ä¸­å‰",
        weight: 15,
        msgs: [
          "å®‰å®šã—ãŸé‹æ°—ã€‚å¤§ããªæŒ‘æˆ¦ã‚ˆã‚Šã€å …å®Ÿãªè¡Œå‹•ãŒå‘ã„ã¦ã„ã‚‹ã€‚",
          "åˆ¤æ–­ãŒæ¯”è¼ƒçš„å†·é™ã€‚ç„¦ã‚‰ãªã‘ã‚Œã°å¤±æ•—ã¯é¿ã‘ã‚‰ã‚Œã‚‹ã€‚",
          "äººé–“é–¢ä¿‚ãŒç©ã‚„ã‹ã€‚å”åŠ›ã‚’æ„è­˜ã™ã‚‹ã¨ç‰©äº‹ãŒé€²ã‚€ã€‚"
        ]
      },
      {
        name: "å°å‰",
        weight: 20,
        msgs: [
          "å°ã•ãªè‰¯ã„ã“ã¨ãŒèµ·ãã‚„ã™ã„æ—¥ã€‚æœŸå¾…ã—ã™ããªã„ã®ãŒã‚³ãƒ„ã€‚",
          "æ´¾æ‰‹ã•ã¯ãªã„ãŒæ‚ªããªã„ã€‚æ—¥å¸¸ã‚’ä¸å¯§ã«éã”ã™ã¨å‰ã€‚",
          "åŠªåŠ›ãŒç„¡é§„ã«ãªã‚‰ãªã„ã€‚çµæœã¯å°‘ã—é…ã‚Œã¦å‡ºã‚‹ã€‚"
        ]
      },
      {
        name: "å‰",
        weight: 30,
        msgs: [
          "ç‰¹åˆ¥ãªå¤‰åŒ–ã¯å°‘ãªã„ã€‚ç¾çŠ¶ç¶­æŒãŒæœ€å–„ã€‚",
          "æ™®é€šã®æ—¥ã€‚ç„¡ç†ã‚’ã—ãªã‘ã‚Œã°å•é¡Œã¯èµ·ãã«ãã„ã€‚",
          "å¯ã‚‚ãªãä¸å¯ã‚‚ãªã—ã€‚äºˆå®šé€šã‚Šé€²ã‚ã‚‹ã®ãŒæ­£è§£ã€‚"
        ]
      },
      {
        name: "æœ«å‰",
        weight: 15,
        msgs: [
          "å‰åŠã¯ã‚„ã‚„åœæ»ã€‚å¾ŒåŠã«æŒã¡ç›´ã™ã€‚",
          "ç„¦ã‚‹ã¨è£ç›®ã«å‡ºã‚‹ã€‚æ™‚é–“ã‚’å‘³æ–¹ã«ã¤ã‘ã‚‹ã“ã¨ã€‚",
          "å°ã•ãªåˆ¤æ–­ãƒŸã‚¹ã«æ³¨æ„ã€‚ç¢ºèªã‚’æ€ ã‚‰ãªã‘ã‚Œã°å•é¡Œãªã„ã€‚"
        ]
      },
      {
        name: "å‡¶",
        weight: 10,
        msgs: [
          "åˆ¤æ–­ãŒã¶ã‚Œã‚„ã™ã„æ—¥ã€‚é‡è¦ãªæ±ºæ–­ã¯æ…é‡ã«ã€‚",
          "ä½™è¨ˆãªä¸€è¨€ãŒèª¤è§£ã‚’æ‹›ãã€‚ç™ºè¨€ã¯æ§ãˆã‚ã«ã€‚",
          "äºˆå®šå¤–ã®å‡ºæ¥äº‹ãŒèµ·ãã‚„ã™ã„ã€‚ä½™è£•ã‚’æŒã£ã¦è¡Œå‹•ã€‚"
        ]
      },
      {
        name: "å¤§å‡¶",
        weight: 5,
        msgs: [
          "ç„¡ç†ã‚’ã™ã‚‹ã¨æ¶ˆè€—ã—ã‚„ã™ã„ã€‚ä»Šæ—¥ã¯å®ˆã‚Šã‚’å„ªå…ˆã€‚",
          "æµã‚ŒãŒè‰¯ããªã„ã€‚å¤§ããªå¤‰æ›´ã¯é¿ã‘ãŸæ–¹ãŒç„¡é›£ã€‚",
          "ä¼‘æ¯ãŒå¿…è¦ãªæ—¥ã€‚ä½“èª¿ç®¡ç†ã‚’æœ€å„ªå…ˆã«ã€‚"
        ]
      }
    ];

    /* ===== ç¢ºç‡ä»˜ãæŠ½é¸ ===== */
    function drawWeightedOmikuji() {
      const total = omikuji.reduce((sum, o) => sum + o.weight, 0);
      let rand = Math.random() * total;

      for (const o of omikuji) {
        if (rand < o.weight) {
          const msg = o.msgs[Math.floor(Math.random() * o.msgs.length)];
          return { name: o.name, msg };
        }
        rand -= o.weight;
      }
    }

    /* ===== ãƒœã‚¿ãƒ³å‡¦ç† ===== */
    function drawOmikuji() {
      const btn = document.getElementById("drawBtn");
      const spinner = document.getElementById("spinner");
      const loadingText = document.getElementById("loadingText");
      const result = document.getElementById("result");
      const special = document.getElementById("special");

      btn.disabled = true;
      result.innerHTML = "";
      special.innerHTML = "";

      // æ¼”å‡ºé–‹å§‹
      spinner.style.display = "block";
      loadingText.style.display = "block";

      setTimeout(() => {
        // æ¼”å‡ºçµ‚äº†
        spinner.style.display = "none";
        loadingText.style.display = "none";

        let count = Number(localStorage.getItem("omikujiCount")) || 0;
        count++;
        localStorage.setItem("omikujiCount", count);

        // 10å›ã”ã¨ã®ç‰¹åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        if (count % 10 === 0) {
          special.innerHTML =
            "ã€ç‰¹åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‘<br><br>" +
            count + "å›å¼•ãã¾ã—ãŸã€‚<br><br>" +
            "é‹å‹¢ã¯å‚è€ƒç¨‹åº¦ã§ååˆ†ã€‚<br>" +
            "<strong>ã‚ã¨ã¯è‡ªåˆ†ã®åˆ¤æ–­ã‚’ä¿¡ã˜ã¦ã€‚</strong><br>"+
            "ãŸã ã—ãŠã¿ãã˜ã¯ä¸€å›ã§ååˆ†ã€‚å¼•ãç›´ã™å¿…è¦ãªã—ã€‚";
          btn.disabled = false;
          return;
        }

        // é€šå¸¸çµæœ
        const r = drawWeightedOmikuji();
        result.innerHTML =
          r.name + "<br><small>" + r.msg + "</small>";

        btn.disabled = false;
      }, 1500);
    }
  </script>

</body>
</html>
